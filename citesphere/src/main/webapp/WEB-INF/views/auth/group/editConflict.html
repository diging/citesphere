<html layout:decorate="~{layouts/main}">
<head></head>
<body>
<div layout:fragment="content">
<ol class="breadcrumb">
  <li><a th:href="@{/}">Home</a></li>
  <li><a th:href="@{items}" />Group</a></li>
  <li class="active">[[${outdatedCitation.key}]]</li>
</ol>

<div class="alert alert-warning" role="alert">
<b>Citation has changed!</b> The citation stored in Citesphere is different than the one in Zotero. 
If you proceed, Citesphere will first update the locally stored citation with the updated data retrieved from 
Zotero and then apply the changes you made. You will be able to review and change your edits before data is sent to Zotero. 
Do you want to proceed?
</div>

<h2>
	<span th:each="author,status : ${outdatedCitation.authors}">
				[[${author.lastName}]]<span th:if="${!#strings.isEmpty(author.firstName)}">, [[${author.firstName}]]</span>
		<span th:if="${!status.last}">; </span>
				
	</span>
	  <em>[[${outdatedCitation.title}]]</em>
	  <span th:if="${!#strings.isEmpty(outdatedCitation.dateFreetext)}">
 	  [[(${outdatedCitation.dateFreetext})]]
 	  </span> 
</h2>

<!--  currently stored citation  -->
<div class="col-md-4">
<h4>Currently stored data (Version [[${outdatedCitation.version}]])</h4>
<table class="table table-striped">
<tr>
<td width="20%">Item Key</td>
<td>[[${outdatedCitation.key}]]</td>
</tr>
<tr>
<td>Citation Type</td>
<td th:with="iconClass=${@iconsResource.getProperty(form.itemType + '_icon')}
			  , iconLabel=${@iconsResource.getProperty(form.itemType + '_label')}">
<i th:classappend="${!#strings.isEmpty(iconClass)} ? ${iconClass} : 'fas fa-file'" th:title="${iconLabel} ?: ${entry.itemType}"></i> [[${iconLabel} ?: ${entry.itemType}]]
</td>
</tr>
<span th:if="${#lists.contains(outdatedCitationFields, 'title') }">
<tr>
<td>Title</td>
<td>[[${outdatedCitation.title}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'shortTitle') }">
<tr>
<td>Short Title</td>
<td>[[${outdatedCitation.shortTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'date') }">
<tr>
<td>Date</td>
<td>[[${outdatedCitation.dateFreetext}]]</td>
</tr>
</span>
<tr>
<td>Authors</td>
<td>
<span th:each="author,status : ${outdatedCitation.authors}">
				[[${author.lastName}]]<span th:if="${!#strings.isEmpty(author.firstName)}">, [[${author.firstName}]]</span>
		<span th:if="${!#lists.isEmpty(author.affiliations)}">
					 (<th:block th:each="aff,affStatus : ${author.affiliations}">
					 	[[${aff.name}]]<span th:if="${!affStatus.last}">, </span>
					 </th:block>)
			<span th:if="${!status.last}">; </span>
		</span>
	</span>
	
	
</td>
</tr>
<tr>
<td>Editors</td>
<td>
<span th:each="editor,status : ${outdatedCitation.editors}">
				[[${editor.lastName}]]<span th:if="${!#strings.isEmpty(editor.firstName)}">, [[${editor.firstName}]]</span>
		<span th:if="${!status.last}">; </span>
				
	</span>
</td>
</tr>
<span th:if="${#lists.contains(outdatedCitationFields, 'publicationTitle') }">
<tr>
<td>Publication Title</td>
<td>[[${outdatedCitation.publicationTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'journalAbbreviation') }">
<tr>
<td>Journal Abbreviation</td>
<td>[[${outdatedCitation.journalAbbreviation}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'volume') }">
<tr>
<td>Volume</td>
<td>[[${outdatedCitation.volume}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'issue') }">
<tr>
<td>Issue</td>
<td>[[${outdatedCitation.issue}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'pages') }">
<tr>
<td>Pages</td>
<td>[[${outdatedCitation.pages}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'series') }">
<tr>
<td>Series</td>
<td>[[${outdatedCitation.series}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'seriesTitle') }">
<tr>
<td>Series Title</td>
<td>[[${outdatedCitation.seriesTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'seriesText') }">
<tr>
<td>Series Text</td>
<td>[[${outdatedCitation.seriesText}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'url') }">
<tr>
<td>URL</td>
<td><a href="${outdatedCitation.url}">[[${outdatedCitation.url}]]</a></td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'language') }">
<tr>
<td>Language</td>
<td>[[${outdatedCitation.language}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'doi') }">
<tr>
<td>DOI</td>
<td>[[${outdatedCitation.doi}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'issn') }">
<tr>
<td>ISSN</td>
<td>[[${outdatedCitation.issn}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'archive') }">
<tr>
<td>Archive</td>
<td>[[${outdatedCitation.archive}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'archiveLocation') }">
<tr>
<td>Archive Location</td>
<td>[[${outdatedCitation.archiveLocation}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'libraryCatalog') }">
<tr>
<td>Library Catalog</td>
<td>[[${outdatedCitation.libraryCatalog}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'callNumber') }">
<tr>
<td>Call Number</td>
<td>[[${outdatedCitation.callNumber}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(outdatedCitationFields, 'rights') }">
<tr>
<td>Rights</td>
<td>[[${outdatedCitation.rights}]]</td>
</tr>
</span>
</table>
</div>

<!--  current citation fields -->
<div class="col-md-4">
<h4>Data retrieved from Zotero (Version [[${currentCitation.version}]])</h4>
<table class="table table-striped">
<tr>
<td width="20%">Item Key</td>
<td>[[${currentCitation.key}]]</td>
</tr>
<tr>
<td>Citation Type</td>


<td>
	<div th:with="iconClass=${@iconsResource.getProperty(currentCitation.itemType + '_icon')}
			 , iconLabel=${@iconsResource.getProperty(currentCitation.itemType + '_label')}">
				<i th:classappend="${!#strings.isEmpty(iconClass)} ? ${iconClass} : 'fas fa-file'" th:title="${iconLabel} ?: ${currentCitation.itemType}"></i> [[${iconLabel} ?: ${currentCitation.itemType}]]
	</div>
</td>



</tr>
<span th:if="${#lists.contains(currentCitationFields, 'title') }">
<tr th:if="${currentCitation.title != outdatedCitation.title}" class="changed">
<td>Title</td>
<td>[[${currentCitation.title}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'shortTitle') }">
<tr th:if="${currentCitation.shortTitle != outdatedCitation.shortTitle}" class="changed">
<td>Short Title</td>
<td>[[${currentCitation.shortTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'date') }">
<tr th:if="${currentCitation.dateFreetext != outdatedCitation.dateFreetext}" class="changed">
<td>Date</td>
<td>[[${currentCitation.dateFreetext}]]</td>
</tr>
</span>
<tr>
<td>Authors</td>
<td>
	<span th:each="author,status : ${currentCitation.authors}">
				[[${author.lastName}]]<span th:if="${!#strings.isEmpty(author.firstName)}">, [[${author.firstName}]]</span>
		<span th:if="${!#lists.isEmpty(author.affiliations)}">
					 (<th:block th:each="aff,affStatus : ${author.affiliations}">
					 	[[${aff.name}]]<span th:if="${!affStatus.last}">, </span>
					 </th:block>)
			<span th:if="${!status.last}">; </span>
		</span>
	</span>
</td>


</tr>
<tr>
<td>Editors</td>
<td>
	<span th:each="editor,status : ${currentCitation.editors}">
				[[${editor.lastName}]]<span th:if="${!#strings.isEmpty(editor.firstName)}">, [[${editor.firstName}]]</span>
		<span th:if="${!status.last}">; </span>
				
	</span>
</td>

</tr>
<span th:if="${#lists.contains(currentCitationFields, 'publicationTitle') }">
<tr th:if="${currentCitation.publicationTitle != outdatedCitation.publicationTitle}" class="changed">
<td>Publication Title</td>
<td>[[${currentCitation.publicationTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'journalAbbreviation') }">
<tr th:if="${currentCitation.journalAbbreviation != outdatedCitation.journalAbbreviation}" class="changed">
<td>Journal Abbreviation</td>
<td>[[${currentCitation.journalAbbreviation}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'volume') }">
<tr th:if="${currentCitation.volume != outdatedCitation.volume}" class="changed">
<td>Volume</td>
<td>[[${currentCitation.volume}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'issue') }">
<tr th:if="${currentCitation.issue != outdatedCitation.issue}" class="changed">
<td>Issue</td>
<td>[[${currentCitation.issue}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'pages') }">
<tr th:if="${currentCitation.pages != outdatedCitation.pages}" class="changed">
<td>Pages</td>
<td>[[${currentCitation.pages}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'series') }">
<tr th:if="${currentCitation.series != outdatedCitation.series}" class="changed">
<td>Series</td>
<td>[[${currentCitation.series}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'seriesTitle') }">
<tr th:if="${currentCitation.seriesTitle != outdatedCitation.seriesTitle}" class="changed">
<td>Series Title</td>
<td >[[${currentCitation.seriesTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'seriesText') }">
<tr th:if="${currentCitation.seriesText != outdatedCitation.seriesText}" class="changed">
<td>Series Text</td>
<td>[[${currentCitation.seriesText}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'url') }">
<tr th:if="${currentCitation.url != outdatedCitation.url}" class="changed">
<td>URL</td>
<td><a href="${currentCitation.url}">[[${currentCitation.url}]]</a></td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'language') }">
<tr th:if="${currentCitation.language != outdatedCitation.language}" class="changed">
<td>Language</td>
<td>[[${currentCitation.language}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'doi') }">
<tr th:if="${currentCitation.doi != outdatedCitation.doi}" class="changed">
<td>DOI</td>
<td>[[${currentCitation.doi}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'issn') }">
<tr th:if="${currentCitation.issn != outdatedCitation.issn}" class="changed">
<td>ISSN</td>
<td>[[${currentCitation.issn}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'archive') }">
<tr th:if="${currentCitation.archive != outdatedCitation.archive}" class="changed">
<td>Archive</td>
<td>[[${currentCitation.archive}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'archiveLocation') }">
<tr th:if="${currentCitation.archiveLocation != outdatedCitation.archiveLocation}" class="changed">
<td>Archive Location</td>
<td>[[${currentCitation.archiveLocation}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'libraryCatalog') }">
<tr th:if="${currentCitation.libraryCatalog != outdatedCitation.libraryCatalog}" class="changed">
<td>Library Catalog</td>
<td>[[${currentCitation.libraryCatalog}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'callNumber') }">
<tr th:if="${currentCitation.callNumber != outdatedCitation.callNumber}" class="changed">
<td>Call Number</td>
<td>[[${currentCitation.callNumber}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(currentCitationFields, 'rights') }">
<tr th:if="${currentCitation.rights != outdatedCitation.rights}" class="changed">
<td>Rights</td>
<td>[[${currentCitation.rights}]]</td>
</tr>
</span>
</table>
</div>

<!-- Form fields -->
<div class="col-md-4">
<h4>Your edits</h4>

<table class="table table-striped">
<tr>
<td width="20%">Item Key</td>
<td>[[${form.key}]]</td>
</tr>
<tr>
<td>Citation Type</td>
<td>
	<div th:with="iconClass=${@iconsResource.getProperty(form.itemType + '_icon')}, iconLabel=${@iconsResource.getProperty(form.itemType + '_label')}">
		<i th:classappend="${!#strings.isEmpty(iconClass)} ? ${iconClass} : 'fas fa-file'" th:title="${iconLabel} ?: ${entry.itemType}"></i> [[${iconLabel} ?: ${entry.itemType}]]
	</div>
</td>
</tr>
<span th:if="${#lists.contains(formFields, 'title') }">
<tr th:if="${form.title != outdatedCitation.title}" class="changed">
<td>Title</td>
<td>[[${form.title}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'shortTitle') }">
<tr th:if="${form.shortTitle != outdatedCitation.shortTitle}" class="changed">
<td>Short Title</td>
<td>[[${form.shortTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'date') }">
<tr th:if="${form.dateFreetext != outdatedCitation.dateFreetext}" class="changed">
<td>Date</td>
<td>[[${form.dateFreetext}]]</td>
</tr>
</span>
<tr>
<td>Authors</td>
<td>

</td>
</tr>
<tr>
<td>Editors</td>
<td>

</tr>
<span th:if="${#lists.contains(formFields, 'publicationTitle') }">
<tr th:if="${form.publicationTitle != outdatedCitation.publicationTitle}" class="changed">
<td>Publication Title</td>
<td>[[${form.publicationTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'journalAbbreviation') }">
<tr th:if="${form.journalAbbreviation != outdatedCitation.journalAbbreviation}" class="changed">
<td>Journal Abbreviation</td>
<td>[[${form.journalAbbreviation}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'volume') }">
<tr th:if="${form.volume != outdatedCitation.volume}" class="changed">
<td>Volume</td>
<td>[[${form.volume}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'issue') }">
<tr th:if="${form.issue != outdatedCitation.issue}" class="changed">
<td>Issue</td>
<td>[[${form.issue}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'pages') }">
<tr th:if="${form.pages != outdatedCitation.pages}" class="changed">
<td>Pages</td>
<td>[[${form.pages}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'series') }">
<tr th:if="${form.series != outdatedCitation.series}" class="changed">
<td>Series</td>
<td>[[${form.series}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'seriesTitle') }">
<tr th:if="${form.seriesTitle != outdatedCitation.seriesTitle}" class="changed">
<td>Series Title</td>
<td>[[${form.seriesTitle}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'seriesText') }">
<tr th:if="${form.seriesText != outdatedCitation.seriesText}" class="changed">
<td>Series Text</td>
<td>[[${form.seriesText}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'url') }">
<tr th:if="${form.url != outdatedCitation.url}" class="changed">
<td>URL</td>
<td><a href="${form.url}">[[${form.url}]]</a></td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'language') }">
<tr th:if="${form.language != outdatedCitation.language}" class="changed">
<td>Language</td>
<td>[[${form.language}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'doi') }">
<tr th:if="${form.doi != outdatedCitation.doi}" class="changed">
<td>DOI</td>
<td>[[${form.doi}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'issn') }">
<tr th:if="${form.issn != outdatedCitation.issn}" class="changed">
<td>ISSN</td>
<td>[[${form.issn}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'archive') }">
<tr th:if="${form.archive != outdatedCitation.archive}" class="changed">
<td>Archive</td>
<td>[[${form.archive}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'archiveLocation') }">
<tr th:if="${form.archiveLocation != outdatedCitation.archiveLocation}" class="changed">
<td>Archive Location</td>
<td>[[${form.archiveLocation}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'libraryCatalog') }">
<tr th:if="${form.libraryCatalog != outdatedCitation.libraryCatalog}" class="changed">
<td>Library Catalog</td>
<td>[[${form.libraryCatalog}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'callNumber') }">
<tr th:if="${form.callNumber != outdatedCitation.callNumber}" class="changed">
<td>Call Number</td>
<td>[[${form.callNumber}]]</td>
</tr>
</span>
<span th:if="${#lists.contains(formFields, 'rights') }">
<tr th:if="${form.rights != outdatedCitation.rights}" class="changed">
<td>Rights</td>
<td>[[${form.rights}]]</td>
</tr>
</span>
</table>
</div>

<div class="col-md-12">
<form action="#" th:action="@{|/auth/group/${zoteroGroupId}/items/${outdatedCitation.key}/conflict/resolve?index=${index}&page=${page}&sortBy=${sortBy}&collectionId=${collectionId}|}" th:object="${form}" method="POST">
<input type="hidden" path="key" th:value="${form.key}" />
<input type="hidden" path="itemType" th:value="${form.itemType}" />
<input type="hidden" path="title" th:value="${form.title}" />
<input type="hidden" path="shortTitle" th:value="${form.shortTitle}" />
<input type="hidden" path="dateFreetext" th:value="${form.dateFreetext}" />
<input type="hidden" path="publicationTitle" th:value="${form.publicationTitle}" />
<input type="hidden" path="journalAbbreviation" th:value="${form.journalAbbreviation}" />
<input type="hidden" path="volume" th:value="${form.volume}" />
<input type="hidden" path="issue" th:value="${form.issue}" />
<input type="hidden" path="pages" th:value="${form.pages}" />
<input type="hidden" path="series" th:value="${form.series}" />
<input type="hidden" path="seriesTitle" th:value="${form.seriesTitle}" />
<input type="hidden" path="seriesText" th:value="${form.seriesText}" />
<input type="hidden" path="url" th:value="${form.url}" />
<input type="hidden" path="language" th:value="${form.language}" />
<input type="hidden" path="doi" th:value="${form.doi}" />
<input type="hidden" path="issn" th:value="${form.issn}" />
<input type="hidden" path="archive" th:value="${form.archive}" />
<input type="hidden" path="archiveLocation" th:value="${form.archiveLocation}" />
<input type="hidden" path="libraryCatalog" th:value="${form.libraryCatalog}" />
<input type="hidden" path="callNumber" th:value="${form.callNumber}" />
<input type="hidden" path="rights" th:value="${form.rights}" />

<button type="submit" class="btn btn-primary">Sounds good, proceed!</button>
<a th:href="@{|/auth/group/${zoteroGroupId}/items/${outdatedCitation.key}?index=${index}&page=${page}&sortBy=${sortBy}&collectionId=${collectionId}|}" class="btn btn-default">No, cancel.</a>
</form:form>
</div>



</div>

</body>
</html>
