<html layout:decorate="~{layouts/main}">
<head>
<style>
#viewUploadBody  {
  padding-left: 30px;
}
</style>
<script th:inline="javascript">
//# sourceURL=modal.js
	$(function() {
		$(".parse-ref-info").click(function(e) {
			var clicked = e.target;
			$("#ref-unparsed").text($(clicked).text());
			$("#parsed-ref-authors").text($(clicked).attr('data-authors'));
			$("#parsed-ref-title").text($(clicked).attr('data-title'));
			$("#parsed-ref-year").text($(clicked).attr('data-year'));
			var identifier = $(clicked).attr('data-identifier');
			var identType = $(clicked).attr('data-identifier-type');
			if (identType != undefined && identType != "") {
				identifier = identifier + " (" + identType + ")";
			}
			$("#parsed-ref-ident").text(identifier);
			$("#parsed-ref-first-page").text($(clicked).attr('data-first-page'));
			$("#parsed-ref-last-page").text($(clicked).attr('data-last-page'));
			$("#parsed-ref-volume").text($(clicked).attr('data-volume'));
			$("#parsed-ref-source").text($(clicked).attr('data-source'));
			$("#parsed-ref-publication-type").text($(clicked).attr('data-publication-type'));
			$("#parsed-ref-reference-id").text($(clicked).attr('data-reference-id'));
			$("#parsed-ref-reference-label").text($(clicked).attr('data-reference-label'));
			$("#parsed-ref-citation-id").text($(clicked).attr('data-citation-id'));
			$("#parsed-ref-ref-raw").text($(clicked).attr('data-ref-raw'));
            
			$("#parsed-ref-modal").modal();
		});
		
		$(".item-note").click(function(e) {
			var note = $(this).find(".note-info")
			$('#note-text').html(note.attr('data-note-text'));
			$('#noteModal').modal();
		});
	});
	
	function truncateNote(noteText) {
		var truncatedNote = ' ';
		var count = 0;
		note = $(noteText);
		note.each(function () {
			var curr = $(this).text();
			if (count >= 20) {
				return false;
			}
			if (count + curr.length > 20) {
				curr = curr.substring(0, 20-count) + "...";
				$(this).text(curr);
			}
			truncatedNote += $(this).text();
			count += curr.length;
		});
		return truncatedNote;
	}

	$(document).ready(function(){
		$("#uploadFileIcon").click(function() {
	        $("#uploadFileModal").modal('show');
	    });
	    
	    $("#uploadFileBtn").click(function(e) {
	        e.preventDefault()
	        
	        /* JQuery doesn't have a files attribute */
	        var uploadFiles = document.getElementById('uploadFileInput').files;
	        var formData = new FormData();
	        for (var i = 0; i < uploadFiles.length; i++) {
	            formData.append("files", uploadFiles[i]);
	        }
	        
	        $.ajax({
	            type: "POST",
	            url: "[(@{|/auth/group/${zoteroGroupId}/items/${citation.key}/files/upload?${_csrf.parameterName}=${_csrf.token}|})]",
	            cache       : false,
	            contentType : false,
	            processData : false,
	            enctype: 'multipart/form-data',
	            data: formData, 
	            success: function(data) {
	                document.getElementById('uploadFileInput').value = '';
	                $("#uploadFileModal").modal('hide');
	            }
	        });
  
	    });
	    
	    var queryParams = window.location.search;
	    if(queryParams)  {
	        var params = new URLSearchParams(queryParams);
	        params.delete('page');
	        params.delete('searchTerm');
	        params.delete('sortBy');
	        params.delete('index');
	        params.delete('collectionId');
	        queryParams = params.toString();
	    }
	    
	    $('.btn-nav').each(function() {
	    	$(this).attr("href", $(this).attr("href") + "&" + queryParams);
	    })
	    $(".view-link").click(function() {
	    	var item = $(this).parent();
	        var modalName = 'viewUpload';
	        showFiles(modalName, item);
	        $("#"+modalName.toLowerCase()+"Modal").modal('show');
		});
	    /* $('#viewuploadModal .close').click(function() {
	        // Reset the content of elements
	        $("#uploadedFileName").attr('href', '').text('');
	        $("#extractedFileName").attr('href', '').text(''); 
	        
	        $("#viewUploadBody modal-body page-title").empty();
	        $("#viewUploadBody modal-body page-list").empty();
	    }); */
	    $('.note-info').each(function() {
	    	$(this).text(truncateNote($(this).attr('data-note-text')));
	    })
	});
	
	function showFiles(modalName, item) {
		
		var uploadItem = $(item);
		var modalNameLCase = modalName.toLowerCase();
		
		/* $("#uploadedFileName").removeAttr('href').text('');
	    $("#extractedFileName").removeAttr('href').text('');
	    $('.modal-body ul').empty(); */
		
	    /* $(uploadItem).children().each(function() {
	        // Clear content of each child element
	    	$('#page-list').empty();
	    }); */

	    $('#page-title, #page-list').remove();
		
		$("#uploadedFileName").attr('href', uploadItem.attr("upload-href"));
		$("#uploadedFileName").text(uploadItem.attr("data-"+modalNameLCase+"-uploadedFile-filename"));
		
		$("#extractedFileName").attr('href', uploadItem.attr("extractedText-href"));
		$("#extractedFileName").text(uploadItem.attr("data-"+modalNameLCase+"-extractedText-filename"));
		
		$('.modal-body ul').append('<li id="page-title"><p style="margin-bottom:0;">Pages: </p></li>');
		var pageCount=1
		$('.modal-body ul').append('<ul id="page-list"></ul>');
		
		$(uploadItem).children().each(function() {
			
           if($(this).attr('class')=="page-item"){
               $('#page-list').append('<li><p style="margin : 0; padding-top:0;">Page '+pageCount+': </p></li>');
           }
           $(this).children().each(function() {
                pageItems = "page-items"+pageCount
                $('#page-list').append('<ul id = "'+pageItems+'"></ul>');
           		$('#page-items'+pageCount).append('<li><p style="margin-bottom:0;">Image: <a href="'+ $(this).attr("image-href")+'">'+$(this).attr("data-"+modalNameLCase+"-image-filename")+'</a></p></li>');
           		$('#page-items'+pageCount).append('<li><p style="margin : 0; padding-top:0;">Text: <a href="'+ $(this).attr("pageText-href")+'">'+$(this).attr("data-"+modalNameLCase+"-pageText-filename")+'</a></p></li>');
           		$('#page-items'+pageCount).append('<li><p style="margin-bottom:0;">OCR Result: <a href="'+ $(this).attr("pageOcr-href")+'">'+$(this).attr("data-"+modalNameLCase+"-pageOcr-filename")+'</a></p></li>');
           		$('#page-items'+pageCount).append('<li><p style="margin : 0; padding-top:0;">Additional Files: </p></li>');
           		
           		var additionalFilesCount = 1;
           		additionalItems = "additional-list"+pageCount
           		$('#page-items'+pageCount).append('<ul id="'+additionalItems+'"></ul>')
           		$(this).children().each(function() {
           			$(this).children().each(function() {
           				$('#additional-list'+pageCount).append('<li><p style="margin-bottom:0;">Additional Files '+additionalFilesCount+': <a href="'+ $(this).attr("additionalFiles-href")+'">'+$(this).attr("data-"+modalNameLCase+"-additionalFiles-filename")+'</a></p></li>');
                   })
                   additionalFilesCount += 1;
               })
               pageCount = pageCount+1;
           })
       }) 
	}
	
</script>
</head>

<body>
<div layout:fragment="content">
	<ol class="breadcrumb">
		<li><a th:href="@{/}">Home</a></li>
		<li><a th:href="@{|/auth/group/${zoteroGroupId}/items|}">Group</a></li>
		<li class="active">[[${citation.key}]]</li>
	</ol>
	
	<div class="pull-left" style="margin-bottom: 20px;">
		<span th:unless="${!#strings.isEmpty(collectionId)}">
			<a th:if="${!#strings.isEmpty(searchTerm)}" class ="btn btn-primary btn-nav" style="font-size:10px;" th:href="@{|/auth/group/${zoteroGroupId}/search?index=${index}&searchTerm=${searchTerm}&page=${page}|}">Back</a> &nbsp;&nbsp;
			<a th:unless="${!#strings.isEmpty(searchTerm)}" class ="btn btn-primary btn-nav" style="font-size:10px;" th:href="@{|/auth/group/${zoteroGroupId}/items?index=${index}&page=${page}&sortBy=${sortBy}|}">Back</a> &nbsp;&nbsp;
		</span>
		 <a
			th:href="@{|${citation.key}/edit?index=${index}&page=${page}&sortBy=${sortBy}&collectionId=${collectionId}|}"><i
			class="icon-edit" style="color: #337ab7; font-size: 14px" title="Edit"></i></a> &nbsp;&nbsp; <a
			th:href="@{|${citation.key}/sync?index=${index}&page=${page}&sortBy=${sortBy}&collectionId=${collectionId}|}"><i
			class="icon-sync" title="Sync Citation"></i></a> &nbsp;&nbsp; 
        <a th:if="${!#strings.isEmpty(searchTerm)}" th:href="@{|${citation.key}/history?searchTerm=${searchTerm}&itemsPage=${page}|}"><i class="icon-layers" style="color: #337ab7;" title="Previous Versions"></i></a>
        <a th:unless="${!#strings.isEmpty(searchTerm)}" th:href="@{|${citation.key}/history?itemsPage=${page}&sortBy=${sortBy}|}"><i class="icon-layers" style="color: #337ab7;" title="Previous Versions"></i></a>
			
		&nbsp;&nbsp;
        <a id="uploadFileIcon" href="#"><i style="color: #337ab7; font-size: 20px" class="icon-multiple-doc"></i></a>
       </div>
	
	<div id="pull-right" class="pull-right" style="min-width: 35px;">
		<a th:if="${!#strings.isEmpty(adjacentCitations.prev)}" class ="btn btn-primary btn-nav" style="font-size:10px;" 
		    th:href="@{|/auth/group/${zoteroGroupId}/items/${adjacentCitations.prev}?searchTerm=${searchTerm}&index=${adjacentCitations.prevIndex}&page=${adjacentCitations.prevPage}&sortBy=${sortBy}&collectionId=${collectionId}|}"> < Previous</a>
		<a th:unless="${!#strings.isEmpty(adjacentCitations.prev)}" class ="btn btn-default btn-nav disabled" style="font-size:10px;"> < Previous</a> &nbsp;&nbsp;

		<a th:if="${!#strings.isEmpty(adjacentCitations.next)}" class ="btn btn-primary btn-nav" style="font-size:10px;" 
		    th:href="@{|/auth/group/${zoteroGroupId}/items/${adjacentCitations.next}?searchTerm=${searchTerm}&index=${adjacentCitations.nextIndex}&page=${adjacentCitations.nextPage}&sortBy=${sortBy}&collectionId=${collectionId}|}">Next ></a>
		<a th:unless="${!#strings.isEmpty(adjacentCitations.next)}" class ="btn btn-default btn-nav disabled" style="font-size:10px;">Next ></a>

	</div>
	
	
	<div class="row">
	<div class="col-xs-12">
	<h2 style="margin-top: 0">
        <th:block th:each="author,status : ${citation.authors}">
            <strong>[[${author.lastName}]]<span th:if="${!#strings.isEmpty(author.firstName)}">, [[${author.firstName}]]</span></strong>
            <span th:if="${!status.last}">; </span>
        </th:block>
        
        <em>[[${citation.title}]]</em>
        <span th:if="${!#strings.isEmpty(citation.dateFreetext)}">
          [[(${citation.dateFreetext})]]
        </span>
    </h2>   
    
	</div>
	<div class="col-md-10">
	<table class="table table-striped">
		<tr>
			<td width="20%">Item Key</td>
			<td>[[${citation.key}]]</td>
		</tr>
		<tr>
			<td>Citation Type</td>
			<td th:with="iconClass=${@iconsResource.getProperty(citation.itemType + '_icon')}, 
			iconLabel=${@iconsResource.getProperty(citation.itemType + '_label')}">
			
			<i th:classappend="${!#strings.isEmpty(iconClass)} ? ${iconClass} : 'icon-docs'" th:title="${iconLabel} ?: ${entry.itemType}"></i> [[${iconLabel} ?: ${entry.itemType}]]
		</tr>
		<tr th:if="${#lists.contains(fields, 'title')}">
			<td>Title</td>
			<td>[[${citation.title}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'shortTitle')}">
			<td>Short Title</td>
			<td>[[${citation.shortTitle}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'date')}">
			<td>Date</td>
			<td>[[${citation.dateFreetext}]]</td>
		</tr>

		<tr>
			<td>Authors</td>
			<td><span th:each="author,status : ${citation.authors}">
				[[${author.lastName}]]<span th:if="${!#strings.isEmpty(author.firstName)}">, [[${author.firstName}]]</span>
				<!-- <span>[[${!#lists.isEmpty(author.affiliations)}]]-[[${author.affiliations}]]</span> -->
				<span th:if="${!#lists.isEmpty(author.affiliations)}">
					 (<th:block th:each="aff,affStatus : ${author.affiliations}">
					 	[[${aff.name}]]<span th:if="${!affStatus.last}">, </span>
					 </th:block>)
				 </span>
				 <span th:if="${!#strings.isEmpty(author.uri)}">
				 	<a th:href="@{|${author.uri}|}" target="_blank"><i class="icon-link"></i></a>
				 </span>
				 <span th:if="${!#strings.isEmpty(author.localAuthorityId)}">
				 	<a th:href="@{|/auth/authority/${author.localAuthorityId}|}"><i class="icon-anchor"></i></a>
				 </span>
				 <span th:if="${!status.last}">; </span>
			</span></td>
		</tr>
		
		<tr>
			<td>Editors</td>
			<td><span th:each="editor,status : ${citation.editors}">
				[[${editor.lastName}]]<span th:if="${!#strings.isEmpty(editor.firstName)}">, [[${editor.firstName}]]</span>
				<span th:if="${!#lists.isEmpty(editor.affiliations)}">
					 (<th:block th:each="aff,affStatus : ${editor.affiliations}">
					 	[[${aff.name}]]<span th:if="${!affStatus.last}">, </span>
					 </th:block>)
				 </span>
				 <span th:if="${!#strings.isEmpty(editor.uri)}">
				 	<a th:href="@{|${editor.uri}|}" target="_blank"><i class="icon-link"></i></a>
				 </span>
				 <span th:if="${!#strings.isEmpty(editor.localAuthorityId)}">
				 	<a th:href="@{|/auth/authority/${editor.localAuthorityId}|}"><i class="icon-anchor"></i></a>
				 </span>
				 <span th:if="${!status.last}">; </span>
			</span></td>
		</tr>
		<tr th:each="role,status: ${citation.otherCreatorRoles}" th:if="${!#strings.equals(role,'editor')}">
			<td>
				[[${#strings.capitalizeWords(@labelsResource.getProperty('_item_attribute_label_${role}', role))}]]
			</td>
			<td>
				<span th:each="creator,creatorStatus: ${citation.otherCreators}" th:if="${#strings.equals(creator.role, role)}">
 					[[${creator.person.lastName}]]<span th:if="${!#strings.isEmpty(creator.person.firstName)}">, [[${creator.person.firstName}]]</span>
					<span th:if="${!#lists.isEmpty(creator.person.affiliations)}">
				
 						(<th:block th:each="aff,affStatus : ${creator.person.affiliations}">
							[[${aff.name}]]<span th:if="${!affStatus.last}">, </span>
						</th:block>)
					</span>
					<span th:if="${!#strings.isEmpty(creator.person.uri)}">
						<a th:href="@{|${creator.person.uri}|}" target="_blank"><i class="icon-link"></i></a>
					</span>
					<span th:if="${!#strings.isEmpty(creator.person.localAuthorityId)}">
						<a th:href="@{|/auth/authority/${creator.person.localAuthorityId}|}"><i class="icon-anchor"></i></a>
					</span>
					<span th:if="${!creatorStatus.last}">; </span>
				</span>
 			</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'publicationTitle')}">
			<td>Publication Title</td>
			<td>[[${citation.publicationTitle}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'journalAbbreviation')}">
			<td>Journal Abbreviation</td>
			<td>[[${citation.journalAbbreviation}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'volume')}">
			<td>Volume</td>
			<td>[[${citation.volume}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'issue')}">
			<td>Issue</td>
			<td>[[${citation.issue}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'pages')}">
			<td>Pages</td>
			<td>[[${citation.pages}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'series')}">
			<td>Series</td>
			<td>[[${citation.series}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'seriesTitle')}">
			<td>Series Title</td>
			<td>[[${citation.seriesTitle}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'seriesText')}">
			<td>Series Text</td>
			<td>[[${citation.seriesText}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'url')}">
			<td>URL</td>
			<td><a href="${citation.url}">[[${citation.url}]]</a></td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'language')}">
			<td>Language</td>
			<td>[[${citation.language}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'doi')}">
			<td>DOI</td>
			<td>[[${citation.doi}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'issn')}">
			<td>ISSN</td>
			<td>[[${citation.issn}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'archive')}">
			<td>Archive</td>
			<td>[[${citation.archive}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'archiveLocation')}">
			<td>Archive Location</td>
			<td>[[${citation.archiveLocation}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'libraryCatalog')}">
			<td>Library Catalog</td>
			<td>[[${citation.libraryCatalog}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'callNumber')}">
			<td>Call Number</td>
			<td>[[${citation.callNumber}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'rights')}">
			<td>Rights</td>
			<td>[[${citation.rights}]]</td>
		</tr>
		<tr th:if="${#lists.contains(fields, 'rights')}">
			<td>Concepts</td>
			<td>
				<span th:each="tag:${citation.conceptTags}" class="badge">[[${tag.conceptName}]] | [[${tag.typeName}]]</span>
			</td>
		</tr>
		<tr>
			<td>References</td>
			<td>
			<th:block th:each="ref:${citation.references}">
					<p class="parse-ref-info" th:data-authors="${ref.authorString}" th:data-title="${ref.title}"
	                        th:data-year="${ref.year}"
	                        th:data-identifier="${ref.identifier}"
	                        th:data-identifier-type="${ref.identifierType}"
	                        th:data-first-page="${ref.firstPage}"
	                        th:data-last-page="${ref.endPage}"
	                        th:data-volume="${ref.volume}"
	                        th:data-source="${ref.source}"
	                        th:data-publication-type="${ref.publicationType}"
	                        th:data-reference-id="${ref.referenceId}"
	                        th:data-reference-label="${ref.referenceLabel}"
	                        th:data-citation-id="${ref.citationId}"
	                        th:data-ref-raw="${#strings.escapeXml(ref.referenceStringRaw)}"
	                        >
						<span class="icon-info-circle"></span>
						[[${ref.referenceString}]]
					</p>
			
			</th:block></td>
		</tr>
		<tr>
		    <td>Attachments</td>
		    <td>
		        <th:block th:each="att:${attachments}">
		            <p><span class="icon-attach" style="font-size: 14px"></span> [[${att.title}]]</p>
		        </th:block>
		    </td>
		</tr>
	</table>
	</div>
	<div class="col-md-2">
        <h3 style="margin-top: 0">Files</h3>
        
        <ul class="list-group" >
	        <li class="list-group-item" th:each="upload, status:${citation.gilesUploads}">
	        <i class="icon-giles"></i>
	        
	        <span th:if="${upload.uploadedFile?.filename}">
	        	<span th:id="|upload${status.index}|" class="upload-item" th:data-viewupload-uploadId="${upload.uploadId}" th:upload-href="@{|/auth/group/${zoteroGroupId}/items/${citation.key}/giles/${upload.uploadedFile?.id}|}" th:data-viewupload-uploadedFile-filename="${upload.uploadedFile?.filename}" th:extractedText-href="@{|/auth/group/${zoteroGroupId}/items/${citation.key}/giles/${upload.extractedText?.id}|}" th:data-viewupload-extractedText-filename="${upload.extractedText?.filename}" >
	        	
	        	<th:block th:each="pages, status:${upload.pages}">
				   <span class="page-item">
				       <span th:id="|pages${status.index}|" class="page-item" th:data-viewupload-uploadId="${upload.uploadId}" th:image-href="@{|/auth/group/${zoteroGroupId}/items/${citation.key}/giles/${pages.image?.id}|}" th:data-viewupload-image-filename="${pages.image?.filename}" th:pageText-href="@{|/auth/group/${zoteroGroupId}/items/${citation.key}/giles/${pages.text?.id}|}" th:data-viewupload-pageText-filename="${pages.text?.filename}" th:pageOcr-href="@{|/auth/group/${zoteroGroupId}/items/${citation.key}/giles/${pages.ocr?.id}|}" th:data-viewupload-pageOcr-filename="${pages.ocr?.filename}" >
					 			
				        <th:block th:each="additionalFiles, status:${pages.additionalFiles}">
                        <span class="additional-item" th:if="${additionalFiles?.filename}">
                             <span th:id="|additionalFiles${status.index}|" class="additional-item" th:data-viewupload-uploadId="${upload.uploadId}" th:additionalFiles-href="@{|/auth/group/${zoteroGroupId}/items/${citation.key}/giles/${additionalFiles?.id}|}" th:data-viewupload-additionalFiles-filename="${additionalFiles?.filename}" >
					 	     </span>
                        </span>
                        </th:block>
                        </span>
                        </span> 
                </th:block>
                <a class="view-link">[[${upload.uploadedFile?.filename}]]</a>
	        </span>
	        </span>
	        <span th:unless="${upload.documentStatus != null && (upload.documentStatus != T(edu.asu.diging.citesphere.model.bib.GilesStatus).SUBMITTED || T(edu.asu.diging.citesphere.model.bib.GilesStatus).NEW)}">
	        File is being processed... ([[${upload.progressId}]])
	        </span>
	        <span th:if="${upload.documentStatus == T(edu.asu.diging.citesphere.model.bib.GilesStatus).FAILED}" class="label label-danger">Failed [[${upload.progressId}]]</span>
	        <span th:if="${upload.documentStatus == T(edu.asu.diging.citesphere.model.bib.GilesStatus).NEW}" class="label label-default">In Queue</span>
	        <span th:if="${upload.documentStatus == T(edu.asu.diging.citesphere.model.bib.GilesStatus).SUBMITTED}" class="label label-default">Processing</span>
	        
	        
	       </li>
        </ul>

	    <div class="modal fade" id="viewuploadModal" 
			tabIndex="-1" role="dialog"
			aria-labelledby="viewUploadModal" aria-hidden="true">
			<div class="modal-dialog" role="document">
            <div class="modal-content" id="viewUploadContent">
               <div class="modal-header">
                   <h4 class="modal-title" id="viewUploadModal">Files uploaded to and extracted by Giles
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    </h4>
                </div>
                <div class="modal-body" id="viewUploadBody">
                  <ul class="list-group" >
                  	 <li><p style="margin-bottom:0;"> Upload File: 
                     <a id="uploadedFileName"> </a>
                     </p></li>
                     <li><p style="margin : 0; padding-top:0;"> Extracted Text: 
                     <a id="extractedFileName"> </a>
                     </p></li>
                   </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal"> Close </button>
                </div>
            </div>
       </div>
    </div>

        <h3>Notes</h3>
        
        <ul class="list-group">
            <li class="item-note list-group-item" th:each="note, status:${notes}">
                <span class="icon-sticky-note" style="color: #337ab7; font-size: 14px"></span><span class="note-info" th:data-note-text="${note.note}"></span>
            </li>
        </ul>
	</div>
	
	</div>
	<div id="parsed-ref-modal" class="modal fade" tabindex="-1" role="dialog">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title">Parse Reference</h4>
	      </div>
	      <div class="modal-body">
	        <p id="ref-unparsed"></p>
	        <table class="table table-striped">
	        <tr>
	            <td width="30%">Author string:</td>
	            <td id="parsed-ref-authors"></td>
	        </tr>
	        <tr>
	            <td>Title:</td>
	            <td id="parsed-ref-title"></td>
	        </tr>
	        <tr>
	            <td>Year:</td>
	            <td id="parsed-ref-year"></td>
	        </tr>
	        <tr>
	            <td>Identifier:</td>
	            <td id="parsed-ref-ident"></td>
	        </tr>
	        <tr>
	            <td>First page:</td>
	            <td id="parsed-ref-first-page"></td>
	        </tr>
	        <tr>
	            <td>Last page:</td>
	            <td id="parsed-ref-last-page"></td>
	        </tr>
	        <tr>
	            <td>Volume:</td>
	            <td id="parsed-ref-volume"></td>
	        </tr>
	        <tr>
	            <td>Source:</td>
	            <td id="parsed-ref-source"></td>
	        </tr>
	        <tr>
	            <td>Publication type:</td>
	            <td id="parsed-ref-publication-type"></td>
	        </tr>
	        <tr>
		        <td colspan="2">
			        
	            </td>
	        </tr>
	        <tr>
	            <td>Reference ID:</td>
	            <td id="parsed-ref-reference-id"></td>
	        </tr>
	        <tr>
	            <td>Reference label:</td>
	            <td id="parsed-ref-reference-label"></td>
	        </tr>
	        <tr>
	            <td>Citation ID:</td>
	            <td id="parsed-ref-citation-id"></td>
	        </tr>
	        <tr>
	            <td>Reference as found:</td>
	            <td id="parsed-ref-ref-raw"></td>
	        </tr>
	        </table>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	      </div>
	    </div><!-- /.modal-content -->
	  </div><!-- /.modal-dialog -->
	</div><!-- /.modal -->
	
	<div id="uploadFileModal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Upload File</h4>
          </div>
          <div class="modal-body">
            <label>Choose file to upload</label>
            <input type="file" id="uploadFileInput">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button id="uploadFileBtn" type="button" class="btn btn-primary">Upload</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="noteModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body" id="note-text"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
</div>
</body>
</html>
